---
title: API Reference
description: Complete API documentation for Bazel File Operations Component
---

import { Code, Tabs, TabItem, Badge } from '@astrojs/starlight/components';

## Bazel Rules

### file_ops_action

Core rule for executing file operations.

```python
file_ops_action(
    name,
    operations = [],
    implementation = "auto",
    security_level = "standard",
    config_file = None,
    allowed_paths = [],
    srcs = [],
    outs = [],
    **kwargs
)
```

#### Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `name` | `string` | **required** | Unique name for this action |
| `operations` | `list[dict]` | `[]` | List of file operations to execute |
| `implementation` | `string` | `"auto"` | Implementation: `"auto"`, `"tinygo"`, `"rust"` |
| `security_level` | `string` | `"standard"` | Security: `"low"`, `"standard"`, `"high"` |
| `config_file` | `label` | `None` | JSON configuration file for batch operations |
| `allowed_paths` | `list[string]` | `[]` | Additional allowed paths for operations |
| `srcs` | `list[label]` | `[]` | Source files for the operation |
| `outs` | `list[label]` | `[]` | Expected output files |

#### Examples

<Tabs>
<TabItem label="Basic Operations">
```python
file_ops_action(
    name = "setup",
    operations = [
        {"operation": "create_directory", "path": "build"},
        {"operation": "copy_file", "src": "main.cpp", "dest": "build/main.cpp"},
    ],
)
```
</TabItem>
<TabItem label="High Security">
```python
file_ops_action(
    name = "secure_copy",
    implementation = "tinygo",
    security_level = "high",
    allowed_paths = ["/tmp/safe-workspace"],
    operations = [
        {"operation": "copy_file", "src": "secret.txt", "dest": "/tmp/safe-workspace/backup.txt"},
    ],
)
```
</TabItem>
<TabItem label="Batch Processing">
```python
file_ops_action(
    name = "batch_ops",
    implementation = "rust",
    config_file = "operations.json",
    srcs = ["operations.json", "input1.txt", "input2.txt"],
    outs = ["output1.txt", "output2.txt"],
)
```
</TabItem>
</Tabs>

### file_ops_test

Test rule for validating file operations.

```python
file_ops_test(
    name,
    operations = [],
    expected_outputs = [],
    **kwargs
)
```

#### Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `name` | `string` | Test name |
| `operations` | `list[dict]` | Operations to test |
| `expected_outputs` | `list[string]` | Files that should be created |

#### Example

```python
file_ops_test(
    name = "copy_test",
    srcs = ["input.txt"],
    operations = [
        {"operation": "copy_file", "src": "input.txt", "dest": "output.txt"},
    ],
    expected_outputs = ["output.txt"],
)
```

## File Operations

### copy_file

Copy a single file with metadata preservation.

#### Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `operation` | `string` | ✅ | Must be `"copy_file"` |
| `src` | `string` | ✅ | Source file path |
| `dest` | `string` | ✅ | Destination file path |
| `preserve_metadata` | `bool` | ❌ | Preserve timestamps and permissions (default: `true`) |
| `overwrite` | `bool` | ❌ | Overwrite existing files (default: `true`) |

#### Examples

<Tabs>
<TabItem label="Basic Copy">
```json
{
  "operation": "copy_file",
  "src": "source.txt",
  "dest": "destination.txt"
}
```
</TabItem>
<TabItem label="Preserve Metadata">
```json
{
  "operation": "copy_file",
  "src": "important.txt",
  "dest": "backup.txt",
  "preserve_metadata": true,
  "overwrite": false
}
```
</TabItem>
</Tabs>

### copy_directory

Recursively copy directories with filtering support.

#### Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `operation` | `string` | ✅ | Must be `"copy_directory"` |
| `src` | `string` | ✅ | Source directory path |
| `dest` | `string` | ✅ | Destination directory path |
| `recursive` | `bool` | ❌ | Copy subdirectories (default: `true`) |
| `include_patterns` | `list[string]` | ❌ | Include only matching files |
| `exclude_patterns` | `list[string]` | ❌ | Exclude matching files |
| `preserve_metadata` | `bool` | ❌ | Preserve timestamps (default: `true`) |

#### Examples

<Tabs>
<TabItem label="Simple Copy">
```json
{
  "operation": "copy_directory",
  "src": "src/",
  "dest": "build/src/"
}
```
</TabItem>
<TabItem label="Filtered Copy">
```json
{
  "operation": "copy_directory",
  "src": "headers/",
  "dest": "build/include/",
  "include_patterns": ["*.h", "*.hpp"],
  "exclude_patterns": ["*_test.h", "*.tmp"]
}
```
</TabItem>
</Tabs>

### create_directory

Create directories with automatic parent creation.

#### Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `operation` | `string` | ✅ | Must be `"create_directory"` |
| `path` | `string` | ✅ | Directory path to create |
| `parents` | `bool` | ❌ | Create parent directories (default: `true`) |
| `permissions` | `string` | ❌ | Directory permissions (default: `"755"`) |

#### Examples

<Tabs>
<TabItem label="Basic Directory">
```json
{
  "operation": "create_directory",
  "path": "build/output"
}
```
</TabItem>
<TabItem label="Custom Permissions">
```json
{
  "operation": "create_directory",
  "path": "secure/",
  "permissions": "700"
}
```
</TabItem>
</Tabs>

### process_json_config <Badge text="Rust Only" variant="note" />

Process complex JSON configurations with batch operations.

#### Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `operation` | `string` | ✅ | Must be `"process_json_config"` |
| `config` | `object` | ✅ | JSON configuration object |

#### JSON Configuration Format

```json
{
  "workspace_dir": "/build/workspace",
  "security": {
    "level": "high",
    "allowed_paths": ["/tmp/safe", "/build/*"]
  },
  "operations": [
    {"type": "copy_file", "src_path": "a.txt", "dest_path": "b.txt"},
    {"type": "mkdir", "path": "output"},
    {"type": "copy_directory", "src_path": "src/", "dest_path": "build/src/"}
  ]
}
```

#### Example

```json
{
  "operation": "process_json_config",
  "config": {
    "workspace_dir": "/tmp/workspace",
    "operations": [
      {"type": "mkdir", "path": "build"},
      {"type": "copy_file", "src_path": "main.cpp", "dest_path": "build/main.cpp"}
    ]
  }
}
```

## Implementation Selection

### Auto Selection

The `"auto"` implementation chooses based on operation characteristics:

| Condition | Selected Implementation |
|-----------|-------------------------|
| Security level = "high" | TinyGo |
| Large files (>10MB) | Rust |
| JSON batch processing | Rust |
| Default | TinyGo |

### TinyGo Implementation

<Badge text="Security Focused" variant="tip" />

**Best for:**
- Security-critical applications
- Small to medium files (under 10MB)
- Memory-constrained environments
- Maximum WebAssembly sandboxing

**Characteristics:**
- Binary size: ~2MB
- Memory usage: ~8MB
- Startup time: ~50ms
- Security: Maximum isolation

### Rust Implementation

<Badge text="Performance Optimized" variant="caution" />

**Best for:**
- High-throughput operations
- Large files (>10MB)
- Complex JSON processing
- Batch operations

**Characteristics:**
- Binary size: ~8MB
- Memory usage: ~16MB
- Startup time: ~100ms
- Features: Advanced JSON, streaming I/O

## Security Levels

### Low Security

- Minimal path validation
- Basic WebAssembly sandboxing
- Fastest performance
- **Use case**: Development, testing

```python
file_ops_action(
    name = "dev_ops",
    security_level = "low",
    operations = [...],
)
```

### Standard Security

- Path traversal protection
- Preopen directory validation
- Balanced performance/security
- **Use case**: Production builds

```python
file_ops_action(
    name = "build_ops",
    security_level = "standard",  # Default
    operations = [...],
)
```

### High Security

- Maximum WebAssembly isolation
- Strict path validation
- Capability-based file access
- **Use case**: Security-critical applications

```python
file_ops_action(
    name = "secure_ops",
    security_level = "high",
    allowed_paths = ["/tmp/safe-workspace"],
    operations = [...],
)
```

## Error Codes

### Operation Errors

| Code | Description | Resolution |
|------|-------------|------------|
| `FILE_NOT_FOUND` | Source file does not exist | Check file paths |
| `PERMISSION_DENIED` | Insufficient permissions | Check file/directory permissions |
| `PATH_TRAVERSAL` | Path traversal attempt detected | Use safe paths within workspace |
| `INVALID_OPERATION` | Unknown operation type | Check operation name spelling |

### Security Errors

| Code | Description | Resolution |
|------|-------------|------------|
| `SANDBOX_VIOLATION` | WebAssembly sandbox violation | Check allowed_paths configuration |
| `UNAUTHORIZED_PATH` | Path not in allowed list | Add path to allowed_paths |
| `CAPABILITY_DENIED` | Missing capability for operation | Review security level settings |

### Implementation Errors

| Code | Description | Resolution |
|------|-------------|------------|
| `COMPONENT_NOT_FOUND` | Implementation not available | Check installation |
| `RUNTIME_ERROR` | WebAssembly runtime error | Check logs for details |
| `CONFIG_ERROR` | Invalid configuration | Validate JSON configuration |

## Environment Variables

### Configuration

| Variable | Description | Default |
|----------|-------------|---------|
| `FILE_OPS_IMPLEMENTATION` | Force implementation choice | `"auto"` |
| `FILE_OPS_SECURITY_LEVEL` | Default security level | `"standard"` |
| `FILE_OPS_LOG_LEVEL` | Logging verbosity | `"info"` |
| `FILE_OPS_PROFILE` | Enable performance profiling | `"false"` |

### Debug Settings

| Variable | Description | Default |
|----------|-------------|---------|
| `FILE_OPS_DEBUG` | Enable debug mode | `"false"` |
| `FILE_OPS_TRACE_OPERATIONS` | Trace all operations | `"false"` |
| `FILE_OPS_VALIDATE_PATHS` | Extra path validation | `"true"` |

## Performance Metrics

### Benchmarks

| Operation | File Size | TinyGo | Rust | Native |
|-----------|-----------|--------|------|--------|
| copy_file | 1MB | 45ms | 32ms | 28ms |
| copy_file | 10MB | 280ms | 195ms | 180ms |
| copy_directory | 100 files | 520ms | 380ms | 350ms |
| create_directory | N/A | 15ms | 12ms | 8ms |

### Memory Usage

| Implementation | Startup | Peak Usage | Steady State |
|---------------|---------|------------|--------------|
| TinyGo | 8MB | 12MB | 10MB |
| Rust | 16MB | 24MB | 20MB |

*Benchmarks on Linux x64, averaged over 100 runs*
